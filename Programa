#formato do dicionário atualmente: 
#        estoque= {produto: [quantidade, valor]}
#lojas= {unidade: estoque}

''' #Menu principal'''
#import json

#inicialização do arquivo json que deve acompanhar o sistema para servir de backup
#with open('estoque.json', 'r') as est:
#    lojas = json.loads(est.read())

#declarações
lojas = {}

#variaveis menus
menulojas= '''
0 - Sair
1 - Adicionar nova loja
2 - Escolher loja
3 - Remover loja
'''

menuprodutos= '''
0 - Sair
1 - Adicionar Produto
2 - Remover Item
3 - Alterar Item
4 - Menu Relatório
                '''

menurelatorios= '''
0- sair
1- Imprimir Estoque
2- Lista de Produtos em falta
3-Valor total em estoque
                '''
#Menu de Lojas
print(menulojas)
menu_lojas= int(input('Digite o comando inicial: '))
    
while menu_lojas != 0:
    if menu_lojas == 1:
       unidade = input('Nome da nova unidade: ')
       if unidade not in lojas:
            lojas[unidade] = {} 
       else:
            print('Unidade já cadastrada')
       menu_lojas = 2

    if menu_lojas == 2:
        print('')
        print("Controle de estoque da loja {0}".format(unidade))
        print(menuprodutos)
        menu_produtos= int(input('Digite o comando: '))
    
        while menu_produtos != 0:
    
            if menu_produtos not in range(5):
                print('')
                print("Digite um comando válido")
            
            if menu_produtos == 1:
                produto = input("Nome do produto: ")

                if produto in lojas[unidade]:
                    print("Produto já cadastrado.")
                else:
                    #bloco que pergunta a quantidade do produto na primeira inserção deste no estoque
                    quant= int(input('Quantidade inicial do produto: '))
                    while quant < 0:
                        print("A quantidade inicial não pode ser negativa.")
                        quant= int(input('Quantidade inicial do produto: '))
                    if produto not in lojas[unidade]:
                        lojas[unidade].setdefault(produto, []).append(quant)
                        
                        
                       #bloco que pergunta o preço do produto na primeira inserção deste no estoque 
                    preco = float(input('Preço do produto: '))
                    while preco <= 0:
                        print('O preço não pode ser negativo ou nulo')
                        preco = float(input('Preço do produto: '))
                    lojas[unidade].setdefault(produto, []).append(preco)
                    print('O produto foi registrado no estoque.')
                    print('')
                    print("Controle de estoque da loja {0}".format(unidade))
                    print(menuprodutos)
                    menu_produtos = input('Digite o comando: ')
    
            if menu_produtos == 2:
                produto= input('Produto a ser deletado: ')
                if produto not in lojas[unidade]:
                    print('Produto não encontrado')
                    ctz = input('Voçê tem certeza que quer deletar {0}? '.format(produto))

                if ctz == 'sim': 
                    del lojas[unidade][deleta]
                    print('Produto deletado')
                    print("Controle de estoque da loja {0}".format(unidade))
                print(menuprodutos)
                menu_produtos = input('Digite o comando PRODUTOS: ')
            
            if menu_produtos == 3:
                produto = input('Qual produto a ser alterado? ')
                if produto in lojas[unidade]:
                    altera = input('Deseja alterar o preço ou a quantidade?  ')
                    if altera == 'preço':        
                        preco = float(input('Qual é o novo preço do produto? '))
                        lojas[unidade][produto]['preco']= preco
                    elif altera == 'produto':
                        quant = int(input('Quantidade: '))
                        lojas[unidade][produto]['quantidade'] = lojas[unidade][produto]['quantidade'] +  quant
                        print('Novo estoque de {0}: {1}'.format(produto,lojas[unidade][produto]['quantidade']))
    #Menu dos relatórios
            if menu_produtos == 4:
                print(menurelatorios)
                menu_relatorios= input('Digite o comando RELATORIOS: ')
                
                if menu_relatorios == 0:
                    print('Até mais')    
                
                if menu_relatorios == 1: # Imprime o Estoque
                    print('')
                    print('Estoque atualizado: ')
                    print('Produto : Quantidade ')
                    for produto in lojas[unidade]:
                        print('{0} : {1}'.format(produto, lojas[unidade][produto][0]))
                        
                if menu_relatorios == 2:    #imprime produtos com valor de estoque negativo
                    estoque_loja=lojas[unidade]
                    for produto, lista in estoque_loja.items():
                      if lista[0]<0: #Para ver se a quantidade tá negativa
                        print('{0}:{1}'.format(produto, lista[0])) 
                if menu_relatorios==3:
                    somatorio = 0
                    estoque_loja= lojas[unidade]
                    for lista in estoque_loja.values(): #Percorre a lista [quanditade, preço]
                        if lista[0]>=0: #Para evitar contar produtos em falta
                          somatorio += lista[0]*lista[1]
                    print('O valor total em estoque na unidade {0} é: R$ {1}'.format(unidade,somatorio))
                print('')
                print("Controle de estoque da loja {0}".format(unidade))
                print(menuprodutos)
                menu_produtos= int(input('Digite o comando: '))

    if menu_lojas == 3:
        deleta= input('Digite o nome da unidade a ser excluída: ').strip
        ctz = input('Voçê tem certeza que quer deletar {0}? '.format(produto))
        if ctz == 'sim': 
            del lojas[deleta]
            print('Loja deletada')
            
        print(menulojas)
menu_lojas= input('Digite o comando inicial: ')

if menu_lojas == 0:
    print('Até mais')    

#original = json.dumps(lojas, sort_keys = True, indent = 4)
#with open('estoque.json','w') as est:
#    est.write(original)
